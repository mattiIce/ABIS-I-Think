$PBExportHeader$f_validate_user_app.srf
global type f_validate_user_app from function_object
end type

forward prototypes
global function boolean f_validate_user_app (string as_user, string as_application, n_tr_abc01 at_tran)
end prototypes

global function boolean f_validate_user_app (string as_user, string as_application, n_tr_abc01 at_tran);//Alex Gerlants. 09/27/2016. Begin
/*
Function:	f_validate_user_app
Returns:		boolean <==	True if user 'as_user' is allowed to use application 'as_application'.
Arguments:	value	string		as_user. We get it from gnv_app.of_GetUserId() in the calling routine.
				value	string		as_application
				value	n_tr_abc01	at_tran
*/

Boolean	lb_rtn = False
Integer	li_count

If Not at_tran.of_isconnected() Then
	connect using at_tran;
End If

select	count(*)
into		:li_count
from		security_user
			join security_user_group on security_user.user_id = security_user_group.user_id
			join security_group_application on security_group_application.user_group_id = security_user_group.user_group_id
			join security_application on security_application.application_id = security_group_application.application_id
			join security_user_application on security_application.application_id = security_user_application.application_id and security_user_application.user_id = security_user.user_id
where		lower(security_user.login_id) = lower(:as_user)
and		lower(security_application.application_name) = lower(:as_application)
and		security_user_application.user_application_privilege = 1
using		at_tran;

If at_tran.sqlcode = 0 Then //OK
	If li_count > 0 Then lb_rtn = True
Else
	//
End If

Return lb_rtn
//Alex Gerlants. 09/27/2016. End
end function

